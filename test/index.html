<!DOCTYPE HTML>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
		<title>Geolocation</title>
		<script src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js'></script>
	</head>

	<body>
		<div id="demo"></div>
		
		<script>
			var current = null;
			var previous = null;
			
			getLocation();
			setInterval(recordPosition, 5000);
			
			function getLocation() {
				if (navigator.geolocation) {
					//navigator.geolocation.getCurrentPosition(recordPosition);
					navigator.geolocation.watchPosition(function(crnt){ current = crnt });
				} else {
					x.innerHTML = "Geolocation is not supported by this browser.";
				}
			}

			function recordPosition() {
				if(previous) {
					var distance = getDistanceKM(current.coords.latitude, current.coords.longitude, previous.coords.latitude, previous.coords.longitude);
					var speed = (distance/5)*360;
					$('#demo').html(
						$('#demo').html()+
						"<br><br><b>Watch read</b>" +
						"<br>Latitude: " + current.coords.latitude + 
						"<br>Longitude: " + current.coords.longitude+
						"<br>Speed: " + speed +
						"<br>Time: " + moment().format('DD/MM/YYYY hh:mm:ss')
					);
				}
				
				previous = {
					coords: {
						latitude: current.coords.latitude,
						longitude: current.coords.longitude
					},
				};
			}
			
			function getDistanceKM(lat1, lon1, lat2, lon2) {
				var R = 6371; // Radius of the earth in km
				var dLat = (lat2-lat1).toRad();	// Javascript functions in radians
				var dLon = (lon2-lon1).toRad(); 
				var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
						Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) * 
						Math.sin(dLon/2) * Math.sin(dLon/2); 
				var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
				var d = R * c; // Distance in km
				return d;
			}

			if(typeof(Number.prototype.toRad) === "undefined") {
				Number.prototype.toRad = function() {
					return this * Math.PI / 180;
				}
			}
			
		</script>
	</body>
</html>